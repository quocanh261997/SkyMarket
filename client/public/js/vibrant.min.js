!function (t, e) { "object" == typeof exports && "object" == typeof module ? module.exports = e() : "function" == typeof define && define.amd ? define([], e) : "object" == typeof exports ? exports.Vibrant = e() : t.Vibrant = e() }(window, function () { return function (r) { var n = {}; function o(t) { if (n[t]) return n[t].exports; var e = n[t] = { i: t, l: !1, exports: {} }; return r[t].call(e.exports, e, e.exports, o), e.l = !0, e.exports } return o.m = r, o.c = n, o.d = function (t, e, r) { o.o(t, e) || Object.defineProperty(t, e, { enumerable: !0, get: r }) }, o.r = function (t) { "undefined" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(t, Symbol.toStringTag, { value: "Module" }), Object.defineProperty(t, "__esModule", { value: !0 }) }, o.t = function (e, t) { if (1 & t && (e = o(e)), 8 & t) return e; if (4 & t && "object" == typeof e && e && e.__esModule) return e; var r = Object.create(null); if (o.r(r), Object.defineProperty(r, "default", { enumerable: !0, value: e }), 2 & t && "string" != typeof e) for (var n in e) o.d(r, n, function (t) { return e[t] }.bind(null, n)); return r }, o.n = function (t) { var e = t && t.__esModule ? function () { return t.default } : function () { return t }; return o.d(e, "a", e), e }, o.o = function (t, e) { return Object.prototype.hasOwnProperty.call(t, e) }, o.p = "", o(o.s = 10) }([function (t, e, r) { "use strict"; Object.defineProperty(e, "__esModule", { value: !0 }), e.mapValues = function (t, e) { var r = {}; for (var n in t) if (t.hasOwnProperty(n)) { var o = t[n]; r[n] = e(o) } return r }, e.assignDeep = function n(o) { for (var t = [], e = 1; e < arguments.length; e++)t[e - 1] = arguments[e]; return t.forEach(function (t) { if (t) for (var e in t) if (t.hasOwnProperty(e)) { var r = t[e]; Array.isArray(r) ? o[e] = r.slice(0) : "object" == typeof r ? (o[e] || (o[e] = {}), n(o[e], r)) : o[e] = r } }), o } }, function (t, e, r) { "use strict"; Object.defineProperty(e, "__esModule", { value: !0 }); var o = r(7), i = r(8), a = r(0), n = function () { function n(t, e) { this._src = t, this.opts = a.assignDeep({}, n.DefaultOpts, e) } return n.use = function (t) { this._pipeline = t }, n.from = function (t) { return new i.default(t) }, Object.defineProperty(n.prototype, "result", { get: function () { return this._result }, enumerable: !0, configurable: !0 }), n.prototype._process = function (t, e) { this.opts.quantizer; t.scaleDown(this.opts); var r = o.buildProcessOptions(this.opts, e); return n._pipeline.process(t.getImageData(), r) }, n.prototype.palette = function () { return this.swatches() }, n.prototype.swatches = function () { throw new Error("Method deprecated. Use `Vibrant.result.palettes[name]` instead") }, n.prototype.getPalette = function () { var e = this, t = arguments[0], r = arguments[1], n = "string" == typeof t ? t : "default", o = "string" == typeof t ? r : t, i = new this.opts.ImageClass; return i.load(this._src).then(function (t) { return e._process(t, { generators: [n] }) }).then(function (t) { return (e._result = t).palettes[n] }).then(function (t) { return i.remove(), o && o(void 0, t), t }).catch(function (t) { return i.remove(), o && o(t), Promise.reject(t) }) }, n.prototype.getPalettes = function () { var e = this, t = arguments[0], r = arguments[1], n = Array.isArray(t) ? t : ["*"], o = Array.isArray(t) ? r : t, i = new this.opts.ImageClass; return i.load(this._src).then(function (t) { return e._process(t, { generators: n }) }).then(function (t) { return (e._result = t).palettes }).then(function (t) { return i.remove(), o && o(void 0, t), t }).catch(function (t) { return i.remove(), o && o(t), Promise.reject(t) }) }, n.DefaultOpts = { colorCount: 64, quality: 5, filters: [] }, n }(); e.default = n }, function (t, e, r) { "use strict"; Object.defineProperty(e, "__esModule", { value: !0 }); var n = function () { function t() { } return t.prototype.scaleDown = function (t) { var e = this.getWidth(), r = this.getHeight(), n = 1; if (0 < t.maxDimension) { var o = Math.max(e, r); o > t.maxDimension && (n = t.maxDimension / o) } else n = 1 / t.quality; n < 1 && this.resize(e * n, r * n, n) }, t }(); e.ImageBase = n, e.applyFilters = function (t, e) { if (0 < e.length) for (var r = t.data, n = r.length / 4, o = void 0, i = void 0, a = void 0, u = void 0, s = void 0, c = 0; c < n; c++) { i = r[0 + (o = 4 * c)], a = r[o + 1], u = r[o + 2], s = r[o + 3]; for (var f = 0; f < e.length; f++)if (!e[f](i, a, u, s)) { r[o + 3] = 0; break } } return t } }, function (t, e, r) { "use strict"; Object.defineProperty(e, "__esModule", { value: !0 }); var o = r(4), n = function () { function e(t, e) { this._rgb = t, this._population = e } return e.applyFilters = function (t, i) { return 0 < i.length ? t.filter(function (t) { for (var e = t.r, r = t.g, n = t.b, o = 0; o < i.length; o++)if (!i[o](e, r, n, 255)) return !1; return !0 }) : t }, e.clone = function (t) { return new e(t._rgb, t._population) }, Object.defineProperty(e.prototype, "r", { get: function () { return this._rgb[0] }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "g", { get: function () { return this._rgb[1] }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "b", { get: function () { return this._rgb[2] }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "rgb", { get: function () { return this._rgb }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "hsl", { get: function () { if (!this._hsl) { var t = this._rgb, e = t[0], r = t[1], n = t[2]; this._hsl = o.rgbToHsl(e, r, n) } return this._hsl }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "hex", { get: function () { if (!this._hex) { var t = this._rgb, e = t[0], r = t[1], n = t[2]; this._hex = o.rgbToHex(e, r, n) } return this._hex }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "population", { get: function () { return this._population }, enumerable: !0, configurable: !0 }), e.prototype.toJSON = function () { return { rgb: this.rgb, population: this.population } }, e.prototype.getRgb = function () { return this._rgb }, e.prototype.getHsl = function () { return this.hsl }, e.prototype.getPopulation = function () { return this._population }, e.prototype.getHex = function () { return this.hex }, e.prototype.getYiq = function () { if (!this._yiq) { var t = this._rgb; this._yiq = (299 * t[0] + 587 * t[1] + 114 * t[2]) / 1e3 } return this._yiq }, Object.defineProperty(e.prototype, "titleTextColor", { get: function () { return this._titleTextColor && (this._titleTextColor = this.getYiq() < 200 ? "#fff" : "#000"), this._titleTextColor }, enumerable: !0, configurable: !0 }), Object.defineProperty(e.prototype, "bodyTextColor", { get: function () { return this._bodyTextColor && (this._bodyTextColor = this.getYiq() < 150 ? "#fff" : "#000"), this._bodyTextColor }, enumerable: !0, configurable: !0 }), e.prototype.getTitleTextColor = function () { return this.titleTextColor }, e.prototype.getBodyTextColor = function () { return this.bodyTextColor }, e }(); e.Swatch = n }, function (t, e, r) { "use strict"; function n(t) { var e = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t); if (!e) throw new RangeError("'" + t + "' is not a valid hex color"); return [e[1], e[2], e[3]].map(function (t) { return parseInt(t, 16) }) } function o(t, e, r) { return e /= 255, r /= 255, t = .04045 < (t /= 255) ? Math.pow((t + .005) / 1.055, 2.4) : t / 12.92, e = .04045 < e ? Math.pow((e + .005) / 1.055, 2.4) : e / 12.92, r = .04045 < r ? Math.pow((r + .005) / 1.055, 2.4) : r / 12.92, [.4124 * (t *= 100) + .3576 * (e *= 100) + .1805 * (r *= 100), .2126 * t + .7152 * e + .0722 * r, .0193 * t + .1192 * e + .9505 * r] } function i(t, e, r) { return e /= 100, r /= 108.883, t = .008856 < (t /= 95.047) ? Math.pow(t, 1 / 3) : 7.787 * t + 16 / 116, [116 * (e = .008856 < e ? Math.pow(e, 1 / 3) : 7.787 * e + 16 / 116) - 16, 500 * (t - e), 200 * (e - (r = .008856 < r ? Math.pow(r, 1 / 3) : 7.787 * r + 16 / 116))] } function a(t, e, r) { var n = o(t, e, r); return i(n[0], n[1], n[2]) } function u(t, e) { var r = t[0], n = t[1], o = t[2], i = e[0], a = e[1], u = e[2], s = r - i, c = n - a, f = o - u, l = Math.sqrt(n * n + o * o), h = i - r, p = Math.sqrt(a * a + u * u) - l, g = Math.sqrt(s * s + c * c + f * f), d = Math.sqrt(g) > Math.sqrt(Math.abs(h)) + Math.sqrt(Math.abs(p)) ? Math.sqrt(g * g - h * h - p * p) : 0; return h /= 1, p /= 1 * (1 + .045 * l), d /= 1 * (1 + .015 * l), Math.sqrt(h * h + p * p + d * d) } function s(t, e) { return u(a.apply(void 0, t), a.apply(void 0, e)) } Object.defineProperty(e, "__esModule", { value: !0 }), e.DELTAE94_DIFF_STATUS = { NA: 0, PERFECT: 1, CLOSE: 2, GOOD: 10, SIMILAR: 50 }, e.hexToRgb = n, e.rgbToHex = function (t, e, r) { return "#" + ((1 << 24) + (t << 16) + (e << 8) + r).toString(16).slice(1, 7) }, e.rgbToHsl = function (t, e, r) { t /= 255, e /= 255, r /= 255; var n = Math.max(t, e, r), o = Math.min(t, e, r), i = 0, a = 0, u = (n + o) / 2; if (n !== o) { var s = n - o; switch (a = .5 < u ? s / (2 - n - o) : s / (n + o), n) { case t: i = (e - r) / s + (e < r ? 6 : 0); break; case e: i = (r - t) / s + 2; break; case r: i = (t - e) / s + 4 }i /= 6 } return [i, a, u] }, e.hslToRgb = function (t, e, r) { var n, o, i; function a(t, e, r) { return r < 0 && (r += 1), 1 < r && (r -= 1), r < 1 / 6 ? t + 6 * (e - t) * r : r < .5 ? e : r < 2 / 3 ? t + (e - t) * (2 / 3 - r) * 6 : t } if (0 === e) n = o = i = r; else { var u = r < .5 ? r * (1 + e) : r + e - r * e, s = 2 * r - u; n = a(s, u, t + 1 / 3), o = a(s, u, t), i = a(s, u, t - 1 / 3) } return [255 * n, 255 * o, 255 * i] }, e.rgbToXyz = o, e.xyzToCIELab = i, e.rgbToCIELab = a, e.deltaE94 = u, e.rgbDiff = s, e.hexDiff = function (t, e) { return s(n(t), n(e)) }, e.getColorDiffStatus = function (t) { return t < e.DELTAE94_DIFF_STATUS.NA ? "N/A" : t <= e.DELTAE94_DIFF_STATUS.PERFECT ? "Perfect" : t <= e.DELTAE94_DIFF_STATUS.CLOSE ? "Close" : t <= e.DELTAE94_DIFF_STATUS.GOOD ? "Good" : t < e.DELTAE94_DIFF_STATUS.SIMILAR ? "Similar" : "Wrong" } }, function (t, e, r) { "use strict"; var n = r(6), o = r(9); n.default.DefaultOpts.ImageClass = o.default, t.exports = n.default }, function (t, e, r) { "use strict"; Object.defineProperty(e, "__esModule", { value: !0 }); var n = r(1); n.default.DefaultOpts.quantizer = "mmcq", n.default.DefaultOpts.generators = ["default"], n.default.DefaultOpts.filters = ["default"], e.default = n.default }, function (t, e, r) { "use strict"; Object.defineProperty(e, "__esModule", { value: !0 }); var s = r(0); e.buildProcessOptions = function (t, e) { var r = t.colorCount, n = t.quantizer, o = t.generators, i = t.filters, a = { colorCount: r }, u = "string" == typeof n ? { name: n, options: {} } : n; return u.options = s.assignDeep({}, a, u.options), s.assignDeep({}, { quantizer: u, generators: o, filters: i }, e) } }, function (t, e, r) { "use strict"; Object.defineProperty(e, "__esModule", { value: !0 }); var n = r(1), o = r(0), i = function () { function t(t, e) { void 0 === e && (e = {}), this._src = t, this._opts = o.assignDeep({}, n.default.DefaultOpts, e) } return t.prototype.maxColorCount = function (t) { return this._opts.colorCount = t, this }, t.prototype.maxDimension = function (t) { return this._opts.maxDimension = t, this }, t.prototype.addFilter = function (t) { return this._opts.filters ? this._opts.filters.push(t) : this._opts.filters = [t], this }, t.prototype.removeFilter = function (t) { if (this._opts.filters) { var e = this._opts.filters.indexOf(t); 0 < e && this._opts.filters.splice(e) } return this }, t.prototype.clearFilters = function () { return this._opts.filters = [], this }, t.prototype.quality = function (t) { return this._opts.quality = t, this }, t.prototype.useImageClass = function (t) { return this._opts.ImageClass = t, this }, t.prototype.useGenerator = function (t, e) { return this._opts.generators || (this._opts.generators = []), this._opts.generators.push(e ? { name: t, options: e } : t), this }, t.prototype.useQuantizer = function (t, e) { return this._opts.quantizer = e ? { name: t, options: e } : t, this }, t.prototype.build = function () { return new n.default(this._src, this._opts) }, t.prototype.getPalette = function (t) { return this.build().getPalette(t) }, t.prototype.getSwatches = function (t) { return this.build().getPalette(t) }, t }(); e.default = i }, function (t, e, r) { "use strict"; var n, o = this && this.__extends || (n = function (t, e) { return (n = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (t, e) { t.__proto__ = e } || function (t, e) { for (var r in e) e.hasOwnProperty(r) && (t[r] = e[r]) })(t, e) }, function (t, e) { function r() { this.constructor = t } n(t, e), t.prototype = null === e ? Object.create(e) : (r.prototype = e.prototype, new r) }); Object.defineProperty(e, "__esModule", { value: !0 }); var i = function (t) { function e() { return null !== t && t.apply(this, arguments) || this } return o(e, t), e.prototype._initCanvas = function () { var t = this.image, e = this._canvas = document.createElement("canvas"), r = e.getContext("2d"); if (!r) throw new ReferenceError("Failed to create canvas context"); this._context = r, e.className = "@vibrant/canvas", e.style.display = "none", this._width = e.width = t.width, this._height = e.height = t.height, r.drawImage(t, 0, 0), document.body.appendChild(e) }, e.prototype.load = function (t) { var n, o, e, r, i, a, u, s = this; if ("string" == typeof t) n = document.createElement("img"), o = t, (u = new URL(o, location.href)).protocol === location.protocol && u.host === location.host && u.port === location.port || (e = window.location.href, r = o, i = new URL(e), a = new URL(r), i.protocol === a.protocol && i.hostname === a.hostname && i.port === a.port) || (n.crossOrigin = "anonymous"), n.src = o; else { if (!(t instanceof HTMLImageElement)) return Promise.reject(new Error("Cannot load buffer as an image in browser")); o = (n = t).src } return this.image = n, new Promise(function (t, e) { var r = function () { s._initCanvas(), t(s) }; n.complete ? r() : (n.onload = r, n.onerror = function (t) { return e(new Error("Fail to load image: " + o)) }) }) }, e.prototype.clear = function () { this._context.clearRect(0, 0, this._width, this._height) }, e.prototype.update = function (t) { this._context.putImageData(t, 0, 0) }, e.prototype.getWidth = function () { return this._width }, e.prototype.getHeight = function () { return this._height }, e.prototype.resize = function (t, e, r) { var n = this._canvas, o = this._context, i = this.image; this._width = n.width = t, this._height = n.height = e, o.scale(r, r), o.drawImage(i, 0, 0) }, e.prototype.getPixelCount = function () { return this._width * this._height }, e.prototype.getImageData = function () { return this._context.getImageData(0, 0, this._width, this._height) }, e.prototype.remove = function () { this._canvas && this._canvas.parentNode && this._canvas.parentNode.removeChild(this._canvas) }, e }(r(2).ImageBase); e.default = i }, function (t, e, r) { "use strict"; var n = r(5), o = r(11); n.use(o.default), t.exports = n }, function (t, e, r) { "use strict"; Object.defineProperty(e, "__esModule", { value: !0 }); var n = r(12), o = r(16), i = (new (r(17).BasicPipeline)).filter.register("default", function (t, e, r, n) { return 125 <= n && !(250 < t && 250 < e && 250 < r) }).quantizer.register("mmcq", n.default).generator.register("default", o.default); e.default = i }, function (t, e, r) { "use strict"; Object.defineProperty(e, "__esModule", { value: !0 }); var i = r(3), a = r(13), u = r(15); function s(t, e) { for (var r = t.size(); t.size() < e;) { var n = t.pop(); if (!(n && 0 < n.count())) break; var o = n.split(), i = o[0], a = o[1]; if (t.push(i), a && 0 < a.count() && t.push(a), t.size() === r) break; r = t.size() } } e.default = function (t, e) { if (0 === t.length || e.colorCount < 2 || 256 < e.colorCount) throw new Error("Wrong MMCQ parameters"); var r = a.default.build(t), n = (r.histogram.colorCount, new u.default(function (t, e) { return t.count() - e.count() })); n.push(r), s(n, .75 * e.colorCount); var o = new u.default(function (t, e) { return t.count() * t.volume() - e.count() * e.volume() }); return o.contents = n.contents, s(o, e.colorCount - o.size()), function (t) { for (var e = []; t.size();) { var r = t.pop(), n = r.avg(); n[0], n[1], n[2], e.push(new i.Swatch(n, r.count())) } return e }(o) } }, function (t, e, r) { "use strict"; Object.defineProperty(e, "__esModule", { value: !0 }); var n = r(14), o = function () { function r(t, e, r, n, o, i, a) { this.histogram = a, this._volume = -1, this._count = -1, this.dimension = { r1: t, r2: e, g1: r, g2: n, b1: o, b2: i } } return r.build = function (t) { var e = new n.default(t, { sigBits: 5 }); return new r(e.rmin, e.rmax, e.gmin, e.gmax, e.bmin, e.bmax, e) }, r.prototype.invalidate = function () { this._volume = this._count = -1, this._avg = null }, r.prototype.volume = function () { if (this._volume < 0) { var t = this.dimension, e = t.r1, r = t.r2, n = t.g1, o = t.g2, i = t.b1, a = t.b2; this._volume = (r - e + 1) * (o - n + 1) * (a - i + 1) } return this._volume }, r.prototype.count = function () { if (this._count < 0) { for (var t = this.histogram, e = t.hist, r = t.getColorIndex, n = this.dimension, o = n.r1, i = n.r2, a = n.g1, u = n.g2, s = n.b1, c = n.b2, f = 0, l = o; l <= i; l++)for (var h = a; h <= u; h++)for (var p = s; p <= c; p++) { f += e[r(l, h, p)] } this._count = f } return this._count }, r.prototype.clone = function () { var t = this.histogram, e = this.dimension; return new r(e.r1, e.r2, e.g1, e.g2, e.b1, e.b2, t) }, r.prototype.avg = function () { if (!this._avg) { var t = this.histogram, e = t.hist, r = t.getColorIndex, n = this.dimension, o = n.r1, i = n.r2, a = n.g1, u = n.g2, s = n.b1, c = n.b2, f = 0, l = void 0, h = void 0, p = void 0; l = h = p = 0; for (var g = o; g <= i; g++)for (var d = a; d <= u; d++)for (var m = s; m <= c; m++) { var b = e[r(g, d, m)]; f += b, l += b * (g + .5) * 8, h += b * (d + .5) * 8, p += b * (m + .5) * 8 } this._avg = f ? [~~(l / f), ~~(h / f), ~~(p / f)] : [~~(8 * (o + i + 1) / 2), ~~(8 * (a + u + 1) / 2), ~~(8 * (s + c + 1) / 2)] } return this._avg }, r.prototype.contains = function (t) { var e = t[0], r = t[1], n = t[2], o = this.dimension, i = o.r1, a = o.r2, u = o.g1, s = o.g2, c = o.b1, f = o.b2; return r >>= 3, n >>= 3, i <= (e >>= 3) && e <= a && u <= r && r <= s && c <= n && n <= f }, r.prototype.split = function () { var t = this.histogram, e = t.hist, r = t.getColorIndex, n = this.dimension, o = n.r1, i = n.r2, a = n.g1, u = n.g2, s = n.b1, c = n.b2, f = this.count(); if (!f) return []; if (1 === f) return [this.clone()]; var l, h, p = i - o + 1, g = u - a + 1, d = c - s + 1, m = Math.max(p, g, d), b = null; l = h = 0; var v = null; if (m === p) { v = "r", b = new Uint32Array(i + 1); for (var _ = o; _ <= i; _++) { l = 0; for (var y = a; y <= u; y++)for (var w = s; w <= c; w++) { l += e[r(_, y, w)] } h += l, b[_] = h } } else if (m === g) { v = "g", b = new Uint32Array(u + 1); for (y = a; y <= u; y++) { l = 0; for (_ = o; _ <= i; _++)for (w = s; w <= c; w++) { l += e[r(_, y, w)] } h += l, b[y] = h } } else { v = "b", b = new Uint32Array(c + 1); for (w = s; w <= c; w++) { l = 0; for (_ = o; _ <= i; _++)for (y = a; y <= u; y++) { l += e[r(_, y, w)] } h += l, b[w] = h } } for (var x = -1, M = new Uint32Array(b.length), L = 0; L < b.length; L++) { var D = b[L]; x < 0 && h / 2 < D && (x = L), M[L] = h - D } var P = this; return function (t) { var e = t + "1", r = t + "2", n = P.dimension[e], o = P.dimension[r], i = P.clone(), a = P.clone(), u = x - n, s = o - x; for (o = u <= s ? (o = Math.min(o - 1, ~~(x + s / 2)), Math.max(0, o)) : (o = Math.max(n, ~~(x - 1 - u / 2)), Math.min(P.dimension[r], o)); !b[o];)o++; for (var c = M[o]; !c && b[o - 1];)c = M[--o]; return i.dimension[r] = o, a.dimension[e] = o + 1, [i, a] }(v) }, r }(); e.default = o }, function (t, e, r) { "use strict"; Object.defineProperty(e, "__esModule", { value: !0 }); var n = function () { function t(t, e) { this.pixels = t; var n = (this.opts = e).sigBits, r = function (t, e, r) { return (t << 2 * n) + (e << n) + r }; this.getColorIndex = r; var o, i, a, u, s, c, f, l, h, p = 8 - n, g = new Uint32Array(1 << 3 * n); o = a = s = 0, i = u = c = Number.MAX_VALUE; for (var d = t.length / 4, m = 0; m < d;) { var b = 4 * m; if (m++ , f = t[b + 0], l = t[b + 1], h = t[b + 2], 0 !== t[b + 3]) g[r(f >>= p, l >>= p, h >>= p)] += 1, o < f && (o = f), f < i && (i = f), a < l && (a = l), l < u && (u = l), s < h && (s = h), h < c && (c = h) } this._colorCount = g.reduce(function (t, e) { return 0 < e ? t + 1 : t }, 0), this.hist = g, this.rmax = o, this.rmin = i, this.gmax = a, this.gmin = u, this.bmax = s, this.bmin = c } return Object.defineProperty(t.prototype, "colorCount", { get: function () { return this._colorCount }, enumerable: !0, configurable: !0 }), t }(); e.default = n }, function (t, e, r) { "use strict"; Object.defineProperty(e, "__esModule", { value: !0 }); var n = function () { function t(t) { this._comparator = t, this.contents = [], this._sorted = !1 } return t.prototype._sort = function () { this._sorted || (this.contents.sort(this._comparator), this._sorted = !0) }, t.prototype.push = function (t) { this.contents.push(t), this._sorted = !1 }, t.prototype.peek = function (t) { return this._sort(), t = "number" == typeof t ? t : this.contents.length - 1, this.contents[t] }, t.prototype.pop = function () { return this._sort(), this.contents.pop() }, t.prototype.size = function () { return this.contents.length }, t.prototype.map = function (t) { return this._sort(), this.contents.map(t) }, t }(); e.default = n }, function (t, e, r) { "use strict"; Object.defineProperty(e, "__esModule", { value: !0 }); var d = r(3), m = r(4), c = { targetDarkLuma: .26, maxDarkLuma: .45, minLightLuma: .55, targetLightLuma: .74, minNormalLuma: .3, targetNormalLuma: .5, maxNormalLuma: .7, targetMutesSaturation: .3, maxMutesSaturation: .4, targetVibrantSaturation: 1, minVibrantSaturation: .35, weightSaturation: 3, weightLuma: 6.5, weightPopulation: .5 }; function f(u, t, s, c, f, l, h, p, g, d) { var m = null, b = 0; return t.forEach(function (t) { var e, r, n = t.getHsl(), o = n[1], i = n[2]; if (p <= o && o <= g && f <= i && i <= l && (r = t, (e = u).Vibrant !== r && e.DarkVibrant !== r && e.LightVibrant !== r && e.Muted !== r && e.DarkMuted !== r && e.LightMuted !== r)) { var a = function (t, e, r, n, o, i, a) { function u(t, e) { return 1 - Math.abs(t - e) } return function () { for (var t = [], e = 0; e < arguments.length; e++)t[e] = arguments[e]; for (var r = 0, n = 0, o = 0; o < t.length; o += 2) { var i = t[o], a = t[o + 1]; r += i * a, n += a } return r / n }(u(t, e), a.weightSaturation, u(r, n), a.weightLuma, o / i, a.weightPopulation) }(o, h, i, c, t.getPopulation(), s, d); (null === m || b < a) && (m = t, b = a) } }), m } e.default = function (t, e) { e = Object.assign({}, c, e); var r, n, o, i, a, u = (r = 0, t.forEach(function (t) { r = Math.max(r, t.getPopulation()) }), r), s = ((a = { Vibrant: null, DarkVibrant: null, LightVibrant: null, Muted: null, DarkMuted: null, LightMuted: null }).Vibrant = f(a, n = t, o = u, (i = e).targetNormalLuma, i.minNormalLuma, i.maxNormalLuma, i.targetVibrantSaturation, i.minVibrantSaturation, 1, i), a.LightVibrant = f(a, n, o, i.targetLightLuma, i.minLightLuma, 1, i.targetVibrantSaturation, i.minVibrantSaturation, 1, i), a.DarkVibrant = f(a, n, o, i.targetDarkLuma, 0, i.maxDarkLuma, i.targetVibrantSaturation, i.minVibrantSaturation, 1, i), a.Muted = f(a, n, o, i.targetNormalLuma, i.minNormalLuma, i.maxNormalLuma, i.targetMutesSaturation, 0, i.maxMutesSaturation, i), a.LightMuted = f(a, n, o, i.targetLightLuma, i.minLightLuma, 1, i.targetMutesSaturation, 0, i.maxMutesSaturation, i), a.DarkMuted = f(a, n, o, i.targetDarkLuma, 0, i.maxDarkLuma, i.targetMutesSaturation, 0, i.maxMutesSaturation, i), a); return function (t, e, r) { if (!t.Vibrant && !t.DarkVibrant && !t.LightVibrant) { if (!t.DarkVibrant && t.DarkMuted) { var n = t.DarkMuted.getHsl(), o = n[0], i = n[1], a = n[2]; a = r.targetDarkLuma, t.DarkVibrant = new d.Swatch(m.hslToRgb(o, i, a), 0) } if (!t.LightVibrant && t.LightMuted) { var u = t.LightMuted.getHsl(); o = u[0], i = u[1], a = u[2], a = r.targetDarkLuma, t.DarkVibrant = new d.Swatch(m.hslToRgb(o, i, a), 0) } } if (!t.Vibrant && t.DarkVibrant) { var s = t.DarkVibrant.getHsl(); o = s[0], i = s[1], a = s[2], a = r.targetNormalLuma, t.Vibrant = new d.Swatch(m.hslToRgb(o, i, a), 0) } else if (!t.Vibrant && t.LightVibrant) { var c = t.LightVibrant.getHsl(); o = c[0], i = c[1], a = c[2], a = r.targetNormalLuma, t.Vibrant = new d.Swatch(m.hslToRgb(o, i, a), 0) } if (!t.DarkVibrant && t.Vibrant) { var f = t.Vibrant.getHsl(); o = f[0], i = f[1], a = f[2], a = r.targetDarkLuma, t.DarkVibrant = new d.Swatch(m.hslToRgb(o, i, a), 0) } if (!t.LightVibrant && t.Vibrant) { var l = t.Vibrant.getHsl(); o = l[0], i = l[1], a = l[2], a = r.targetLightLuma, t.LightVibrant = new d.Swatch(m.hslToRgb(o, i, a), 0) } if (!t.Muted && t.Vibrant) { var h = t.Vibrant.getHsl(); o = h[0], i = h[1], a = h[2], a = r.targetMutesSaturation, t.Muted = new d.Swatch(m.hslToRgb(o, i, a), 0) } if (!t.DarkMuted && t.DarkVibrant) { var p = t.DarkVibrant.getHsl(); o = p[0], i = p[1], a = p[2], a = r.targetMutesSaturation, t.DarkMuted = new d.Swatch(m.hslToRgb(o, i, a), 0) } if (!t.LightMuted && t.LightVibrant) { var g = t.LightVibrant.getHsl(); o = g[0], i = g[1], a = g[2], a = r.targetMutesSaturation, t.LightMuted = new d.Swatch(m.hslToRgb(o, i, a), 0) } }(s, 0, e), s } }, function (t, e, r) { "use strict"; var i = this && this.__awaiter || function (i, a, u, s) { return new (u || (u = Promise))(function (t, e) { function r(t) { try { o(s.next(t)) } catch (t) { e(t) } } function n(t) { try { o(s.throw(t)) } catch (t) { e(t) } } function o(e) { e.done ? t(e.value) : new u(function (t) { t(e.value) }).then(r, n) } o((s = s.apply(i, a || [])).next()) }) }, f = this && this.__generator || function (r, n) { var o, i, a, t, u = { label: 0, sent: function () { if (1 & a[0]) throw a[1]; return a[1] }, trys: [], ops: [] }; return t = { next: e(0), throw: e(1), return: e(2) }, "function" == typeof Symbol && (t[Symbol.iterator] = function () { return this }), t; function e(e) { return function (t) { return function (e) { if (o) throw new TypeError("Generator is already executing."); for (; u;)try { if (o = 1, i && (a = 2 & e[0] ? i.return : e[0] ? i.throw || ((a = i.return) && a.call(i), 0) : i.next) && !(a = a.call(i, e[1])).done) return a; switch (i = 0, a && (e = [2 & e[0], a.value]), e[0]) { case 0: case 1: a = e; break; case 4: return u.label++ , { value: e[1], done: !1 }; case 5: u.label++ , i = e[1], e = [0]; continue; case 7: e = u.ops.pop(), u.trys.pop(); continue; default: if (!(a = 0 < (a = u.trys).length && a[a.length - 1]) && (6 === e[0] || 2 === e[0])) { u = 0; continue } if (3 === e[0] && (!a || e[1] > a[0] && e[1] < a[3])) { u.label = e[1]; break } if (6 === e[0] && u.label < a[1]) { u.label = a[1], a = e; break } if (a && u.label < a[2]) { u.label = a[2], u.ops.push(e); break } a[2] && u.ops.pop(), u.trys.pop(); continue }e = n.call(r, u) } catch (t) { e = [6, t], i = 0 } finally { o = a = 0 } if (5 & e[0]) throw e[1]; return { value: e[0] ? e[1] : void 0, done: !0 } }([e, t]) } } }; Object.defineProperty(e, "__esModule", { value: !0 }); var n = r(2), o = function () { function t(t) { this.pipeline = t, this._map = {} } return t.prototype.names = function () { return Object.keys(this._map) }, t.prototype.has = function (t) { return !!this._map[t] }, t.prototype.get = function (t) { return this._map[t] }, t.prototype.register = function (t, e) { return this._map[t] = e, this.pipeline }, t }(); e.Stage = o; var a = function () { function t() { this.filter = new o(this), this.quantizer = new o(this), this.generator = new o(this) } return t.prototype._buildProcessTasks = function (t) { var e = this, r = t.filters, n = t.quantizer, o = t.generators; return 1 === o.length && "*" === o[0] && (o = this.generator.names()), { filters: r.map(function (t) { return i(e.filter, t) }), quantizer: i(this.quantizer, n), generators: o.map(function (t) { return i(e.generator, t) }) }; function i(t, e) { var r, n; return "string" == typeof e ? r = e : (r = e.name, n = e.options), { name: r, fn: t.get(r), options: n } } }, t.prototype.process = function (s, c) { return i(this, void 0, void 0, function () { var e, r, n, o, i, a, u; return f(this, function (t) { switch (t.label) { case 0: return e = this._buildProcessTasks(c), r = e.filters, n = e.quantizer, o = e.generators, [4, this._filterColors(r, s)]; case 1: return i = t.sent(), [4, this._generateColors(n, i)]; case 2: return a = t.sent(), [4, this._generatePalettes(o, a)]; case 3: return u = t.sent(), [2, { colors: a, palettes: u }] } }) }) }, t.prototype._filterColors = function (t, e) { return Promise.resolve(n.applyFilters(e, t.map(function (t) { return t.fn }))) }, t.prototype._generateColors = function (t, e) { return Promise.resolve(t.fn(e.data, t.options)) }, t.prototype._generatePalettes = function (n, o) { return i(this, void 0, void 0, function () { var e; return f(this, function (t) { switch (t.label) { case 0: return [4, Promise.all(n.map(function (t) { var e = t.fn, r = t.options; return Promise.resolve(e(o, r)) }))]; case 1: return e = t.sent(), [2, Promise.resolve(e.reduce(function (t, e, r) { return t[n[r].name] = e, t }, {}))] } }) }) }, t }(); e.BasicPipeline = a }]) });